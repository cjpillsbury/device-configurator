var e="spanning",n="single-fold-horizontal",t="single-fold-vertical",i="none",o="__foldables_env_vars__",r="(@media.*?\\b"+e+"\\b[^{]+)\\{([\\s\\S]+?\\})\\s*\\}",a=/\((.*?)\)/gi,d=/@media[^\(]+/gi,l=function(e){return new RegExp("env\\(\\s*"+e+"\\s*\\)","gi")};function s(e,n){return e.replace(new RegExp(r,"gi"),n)}function c(o){var l=function(e){var n,t=new RegExp(r,"gi");if("function"==typeof e.matchAll)n=Array.from(e.matchAll(t));else{for(n=[];n[n.length]=t.exec(e););n.length--}return n}(o),s={"single-fold-horizontal":"","single-fold-vertical":"",none:""};return l.forEach((function(o){var r=o[1],l=o[2],c=i;r.indexOf(n)>-1&&(c=n),r.indexOf(t)>-1&&(c=t);var f=r.match(d)||[],u=r.match(a)||[];u=u.filter((function(n){return!n.includes(e)})).join(" and "),s[c]+="\n      "+f+" "+u+" {\n        "+l+"\n      }"})),s}var f,u=window.matchMedia("(spanning: single-fold-horizontal)").matches||window.matchMedia("(spanning: single-fold-vertical)").matches||window.matchMedia("(spanning: none)").matches||!1;if(console.info("CSS Spanning Media Queries are supported? "+u),!u){if(void 0===window[o]){var h=document.createDocumentFragment();Object.defineProperty(window,o,{value:{update:v,spanning:sessionStorage.getItem(o+"-spanning")||i,foldSize:+sessionStorage.getItem(o+"-foldSize")||0,browserShellSize:+sessionStorage.getItem(o+"-browserShellSize")||0,addEventListener:h.addEventListener.bind(h),dispatchEvent:h.dispatchEvent.bind(h)}}),window.addEventListener("message",(function(e){"update"===(e.data.action||"")&&window[o].update(e.data.value||{})}))}var p=Array.from(document.querySelectorAll('link[rel="stylesheet"], style'));(f=p,Promise.all(f.map((function(e){var n=e.href;return n?fetch(n).then((function(e){return e.text()})):e.textContent})))).then((function(e){if(u)return sheet;var n=new DocumentFragment;e.forEach((function(e,t){for(var i,o,r,a=s(e,""),d=c(e),l=p[t].href||"inline",f=0,u=Object.entries(d);f<u.length;f+=1){var h=u[f];w[h[0]]+="/* origin:  "+l+" */\n"+h[1]}n.appendChild((i={"data-css-origin":l},o=a,r=document.createElement("style"),Object.keys(i).forEach((function(e){r.setAttribute(e,i[e])})),void 0!==o&&(r.textContent=o),r))})),p.forEach((function(e){return null!=e.parentElement&&e.parentElement.removeChild(e)})),document.head.appendChild(n),S()}))}var g=new Set(["foldSize","browserShellSize","spanning"]);function v(e){if(u)throw new DOMException("Failed updating; spanning is natively supported by the user agent.","NotSupportedError");Object.keys(e).forEach((function(n){g.has(n)&&(window[o][n]=e[n],sessionStorage.setItem(o+"-"+n,window[o][n]))})),window[o].dispatchEvent(new Event("update"))}var w={};function m(e,o){var r;if(u)return e;var a=s(e,""),d=c(e);o&&(w[o]=((r={})[n]="",r[t]="",r[i]="",r));for(var l=o?w[o]:w,f=o||"inline",h=0,p=Object.entries(d);h<p.length;h+=1){var g=p[h];l[g[0]]+="/* origin:  "+f+" */\n"+g[1]}return l["non-spanning"]=a,a}function S(e){u||(E(e),window.addEventListener("resize",(function(){return n=E(e),function(){var e=arguments,i=this;clearTimeout(t),t=setTimeout((function(){return n.apply(i,e)}),150)};var n,t})),window[o].addEventListener("update",(function(){return E(e)})))}function E(e){for(var i,r,a,d,s,c,f,u=window[o],h=e?w[e.nodeName.toLowerCase()][u.spanning]:w[u.spanning],p=e?w[e.nodeName.toLowerCase()]["non-spanning"]:null,g=0,v=Object.entries((a=void 0,d=void 0,s=void 0,c=void 0,f=void 0,d=0,s=0,c=0,f=0,(r=u).spanning===t&&(c=r.foldSize,f=window.innerHeight,d=window.innerWidth/2-r.foldSize/2),r.spanning===n&&(c=window.innerWidth,f=r.foldSize,s=(window.innerHeight-r.browserShellSize)/2-r.foldSize/2),(a={})["fold-top"]=s,a["fold-left"]=d,a["fold-height"]=f,a["fold-width"]=c,a));g<v.length;g+=1){var m=v[g];i=m[1]+"px",h=h.replace(l(m[0]),i)}var S=function(e,n){for(var t=0,i=e.querySelectorAll("."+o);t<i.length;t+=1)i[t].remove();var r=document.createElement("style");r.className=o,r.textContent=n,e===document?document.head.appendChild(r):e.appendChild(r)};if(e){var E=e.shadowRoot;"adoptedStyleSheets"in E&&E.adoptedStyleSheets.length>0?E.adoptedStyleSheets[0].replace(p+h):S(E,h)}else S(document,h)}w[n]="",w[t]="",w[i]="";export{m as adjustCSS,S as observe,v as update};
//# sourceMappingURL=spanning-css-polyfill.js.map
